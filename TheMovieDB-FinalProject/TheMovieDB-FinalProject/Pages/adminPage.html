<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        #userListDiv {
            visibility: hidden;
        }
        #seriesListDiv {
            visibility: hidden;
        }
    </style>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <!-- JQuerry -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous">
    </script>

    <!-- Sweet Alert -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <!-- AJAX -->
    <script src="../Scripts/ajaxCalls.js"></script>

    <!-- Data Tables -->
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>

    <!-- Functions -->
    <script>

        // ---------------------------------------- Constroller functions--------------------------
        $(document).ready(function () {

            $('.navbar').on('click', '#getUserListBTN', function () {
                getUsers();
            });

            $('.navbar').on('click', '#getSeriesListBTN', function () {
                getSeries();
            });

        });
        // ---------------------------------------- API calls -------------------------------------
        {

            // Users ------------------------------------------------------------------------------

            {

                //--------------------------------------- GET ---------------------------------------

                function getUsers() {
                    let api = "../api/Users";

                    ajaxCall("GET", api, "", getUsersSuccessCB, getUsersErrorCB);
                }

                function getUsersSuccessCB(users) {
                    renderUsers(users);
                }

                function getUsersErrorCB(err) {
                    console.log(err.status + " " + err.responseJSON.Message);
                    if (err.status == '404')
                        swal("Error!", "404: " + err.responseJSON.Message, "error");
                    else
                        swal("Error!", err.responseJSON.Message, "error");
                }
            }

            // Series -----------------------------------------------------------------------------

            {

                //--------------------------------------- GET ---------------------------------------

                function getSeries() {
                    let api = "../api/Series";

                    ajaxCall("GET", api, "", getSeriesSuccessCB, getSeriesErrorCB);
                }

                function getSeriesSuccessCB(series) {
                    renderSeries(series);
                }

                function getSeriesErrorCB(err) {
                    console.log(err.status + " " + err.responseJSON.Message);
                    if (err.status == '404')
                        swal("Error!", "404: " + err.responseJSON.Message, "error");
                    else
                        swal("Error!", err.responseJSON.Message, "error");
                }
            }


            // ---------------------------------------- Functions -------------------------------------

            {

                function renderUsers(users) {
                    $("#userListDiv").css("visibility", "visible");
                    try {
                        tbl = $('#usersList').DataTable({
                            data: users,
                            pageLength: 5,
                            columns: [
                                { data: "User_id" },
                                { data: "Email" },
                                { data: "First_name" },
                                { data: "Last_name" },
                                { data: "Password" },
                                { data: "Phone_num" },
                                { data: "Address" },
                                { data: "Fav_genre" },
                                { data: "Gender" },
                                { data: "Birth_date" },
                            ],
                        });
                    }
                    catch (err) {
                        alert(err);
                    }
                }

                function renderSeries(series) {
                    $("#seriesListDiv").css("visibility", "visible");
                    try {
                        tbl = $('#seriesList').DataTable({
                            data: series,
                            pageLength: 5,
                            columns: [
                                { data: "Tv_id" },
                                { data: "First_air_date" },
                                { data: "Name" },
                                { data: "Origin_country" },
                                { data: "Original_language" },
                                { data: "Overview" },
                                { data: "Poster_path" },
                                { data: "Popularity" },
                            ],
                        });
                    }
                    catch (err) {
                        alert(err);
                    }
                }
            }
        }
    </script>
</head>
<body>
    <!-- Page Top -->
    <nav class="navbar navbar-light bg-light">
        <div class="container justify-content-start" id="#nav">
            <h5 class="me-3" id="WlcmMsg">Admin Page</h5>
            <button type="button" class="btn btn-primary me-3" id="getUserListBTN">Get users list</button>
            <button type="button" class="btn btn-primary me-3" id="getSeriesListBTN">Get Series list</button>
        </div>
    </nav>

    <div id="userListDiv">
        <table id="usersList" class="display nowrap" style="width:100%">
            <thead>
                <tr>
                    <th>User_id</th>
                    <th>Email</th>
                    <th>First_name</th>
                    <th>Last_name</th>
                    <th>Password</th>
                    <th>Phone_num</th>
                    <th>Address</th>
                    <th>Fav_genre</th>
                    <th>Gender</th>
                    <th>Birth_date</th>
                </tr>
            </thead>
        </table>
    </div>

    <div id="seriesListDiv">
        <table id="seriesList" class="display nowrap" style="width:100%">
            <thead>
                <tr>
                    <th>Tv_id</th>
                    <th>First_air_date</th>
                    <th>Name</th>
                    <th>Origin_country</th>
                    <th>Original_language</th>
                    <th>Overview</th>
                    <th>Poster_path</th>
                    <th>Popularity</th>
                </tr>
            </thead>
        </table>
    </div>
</body>
</html>
