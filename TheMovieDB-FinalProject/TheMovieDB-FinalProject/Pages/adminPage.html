<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <title></title>

    <style>
        #userListDiv {
            visibility: hidden;
        }

        #seriesListDiv {
            visibility: hidden;
        }

        #episodeListDiv {
            visibility: hidden;
        }
    </style>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x"
          crossorigin="anonymous">

    <!-- JQuerry -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous">
    </script>

    <!-- Sweet Alert -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <!-- AJAX -->
    <script src="../Scripts/ajaxCalls.js"></script>

    <!-- Data Tables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap5.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>

    <!-- Data Table - Extension : Rsponsive -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.min.css">
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

    <!-- Functions -->
    <script>

        // ---------------------------------------- Constroller functions--------------------------
        $(document).ready(function () {

            $('.navbar').on('click', '#getUserListBTN', function () {
                getUsers();
            });

            $('.navbar').on('click', '#getSeriesListBTN', function () {
                getSeries();
            });

            $('.navbar').on('click', '#getEpisodesListBTN', function () {
                getEpisodes();
            });


        });
        // ---------------------------------------- API calls -------------------------------------
        {

            // Users ------------------------------------------------------------------------------

            {

                //--------------------------------------- GET ---------------------------------------

                function getUsers() {
                    let api = "../api/Users";

                    ajaxCall("GET", api, "", getUsersSuccessCB, getUsersErrorCB);
                }

                function getUsersSuccessCB(users) {
                    renderUsers(users);
                }

                function getUsersErrorCB(err) {
                    console.log(err.status + " " + err.responseJSON.Message);
                    if (err.status == '404')
                        swal("Error!", "404: " + err.responseJSON.Message, "error");
                    else
                        swal("Error!", err.responseJSON.Message, "error");
                }
            }

            // Series -----------------------------------------------------------------------------

            {

                //--------------------------------------- GET ---------------------------------------

                function getSeries() {
                    let api = "../api/Series";

                    ajaxCall("GET", api, "", getSeriesSuccessCB, getSeriesErrorCB);
                }

                function getSeriesSuccessCB(series) {
                    renderSeries(series);
                }

                function getSeriesErrorCB(err) {
                    console.log(err.status + " " + err.responseJSON.Message);
                    if (err.status == '404')
                        swal("Error!", "404: " + err.responseJSON.Message, "error");
                    else
                        swal("Error!", err.responseJSON.Message, "error");
                }
            }

            // Episodes -----------------------------------------------------------------------------

            {

                //--------------------------------------- GET ---------------------------------------

                function getEpisodes() {
                    let api = "../api/Episodes";

                    ajaxCall("GET", api, "", getEpisodesSuccessCB, getEpisodesErrorCB);
                }

                function getEpisodesSuccessCB(episodes) {
                    renderEpisodes(episodes);
                }

                function getEpisodesErrorCB(err) {
                    console.log(err.status + " " + err.responseJSON.Message);
                    if (err.status == '404')
                        swal("Error!", "404: " + err.responseJSON.Message, "error");
                    else
                        swal("Error!", err.responseJSON.Message, "error");
                }
            }


            // ---------------------------------------- Functions -------------------------------------

            {

                function renderUsers(users) {
                    $("#userListDiv").css("visibility", "visible");
                    try {
                        tbl = $('#usersList').DataTable({
                            data: users,
                            pageLength: 5,
                            columns: [
                                { data: "User_id" },
                                { data: "Email" },
                                { data: "First_name" },
                                { data: "Last_name" },
                                { data: "Password" },
                                { data: "Phone_num" },
                                { data: "Address" },
                                { data: "Fav_genre" },
                                { data: "Gender" },
                                { data: "Birth_date" },
                            ],
                        });
                    }
                    catch (err) {
                        alert(err);
                    }
                }

                function renderSeries(series) {
                    $("#seriesListDiv").css("visibility", "visible");
                    try {
                        tbl = $('#seriesList').DataTable({
                            data: series,
                            pageLength: 5,
                            columns: [
                                { data: "Tv_id" },
                                { data: "First_air_date" },
                                { data: "Name" },
                                { data: "Origin_country" },
                                { data: "Original_language" },
                                { data: "Overview" },
                                { data: "Poster_path" },
                                { data: "Popularity" },
                            ],
                        });
                    }
                    catch (err) {
                        alert(err);
                    }
                }

                function renderEpisodes(episodes) {
                    $("#episodeListDiv").css("visibility", "visible");
                    try {
                        tbl = $('#episodeList').DataTable({
                            data: episodes,
                            pageLength: 5,
                            columns: [
                                { data: "Name" },
                                { data: "Still_path" },
                                { data: "Overview" },
                                { data: "Tv_id" },
                                { data: "Season_number" },
                                { data: "Episode_number" },
                                { data: "Air_date" },
                            ],
                        });
                    }
                    catch (err) {
                        alert(err);
                    }
                }

            }
        }
    </script>
</head>
<body>
    <!-- Page Top -->
    <nav class="navbar navbar-light bg-light">
        <div class="container justify-content-start" id="#nav">
            <h5 class="me-3" id="WlcmMsg">Admin Page</h5>
            <button type="button" class="btn btn-primary me-3" id="getUserListBTN">Get Users list</button>
            <button type="button" class="btn btn-primary me-3" id="getSeriesListBTN">Get Series list</button>
            <button type="button" class="btn btn-primary me-3" id="getEpisodesListBTN">Get Episodes list</button>
        </div>
    </nav>
    <div class="container">
        <div id="userListDiv">
            <table id="usersList" class="table">
                <thead>
                    <tr>
                        <th>id</th>
                        <th>Email</th>
                        <th>First name</th>
                        <th>Last name</th>
                        <th>Password</th>
                        <th>Phone number</th>
                        <th>Address</th>
                        <th>Favorite genre</th>
                        <th>Gender</th>
                        <th>Birth date</th>
                    </tr>
                </thead>
            </table>
        </div>

        <div id="seriesListDiv">
            <table id="seriesList" class="table">
                <thead>
                    <tr>
                        <th>id</th>
                        <th>First air date</th>
                        <th>Name</th>
                        <th>Origin country</th>
                        <th>Original language</th>
                        <th>Overview</th>
                        <th>Poster path</th>
                        <th>Popularity</th>
                    </tr>
                </thead>
            </table>
        </div>

        <div id="episodeListDiv">
            <table id="episodeList" class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Still path</th>
                        <th>Overview</th>
                        <th>Tv id</th>
                        <th>Season number</th>
                        <th>Episode number</th>
                        <th>Air date</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <!-- Bootstrap dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
            crossorigin="anonymous"></script>
</body>
</html>
